<?php/***	搜索结果展示页**/class SearchController extends Yaf_Controller_Abstract {	protected $check ;		public function indexAction() {			$this->check = new Antihack_Check_Login();		$render_login_data = $this->check->checklogin();		if ($render_login_data['login'] == 1) {			$this->getView()->assign("login",1);			$this->getView()->assign("user_id",$render_login_data['user_id']);			$this->getView()->assign("username",$render_login_data['username']);			$this->getView()->assign("user_photo",$render_login_data['user_photo']);		} else {			$this->getView()->assign("login",0);		}			if (Yaf_Registry::get("register")) {			$this->getView()->assign("activekey",Yaf_Registry::get("register"));		}			#echo "<pre>";		$navbars = $this->getnavbar("category");		$categorys = $this->getcategory();		//$content = $this->content();		$rightbars = $this->getrightbar();		$this->getView()->assign("title"," 搜索 - i比熊 ");		$this->getView()->assign("navbar",$navbars);		$this->getView()->assign("category",$categorys);		$this->getView()->assign("rightbar",$rightbars);		//$this->getView()->assign("content",$content);		#$script = Yaf_Application::app()->getConfig()->smarty->template_dir."index/category.tpl";		#print_r($script);		$this->getView()->display(Yaf_Application::app()->getConfig()->smarty->template_dir . "index/searchindex.tpl");	}		public function searchAction() {		if ($this->getRequest()->isPost()) {				$this->check = new Antihack_Check_Login();			$render_login_data = $this->check->checklogin();			if ($render_login_data['login'] == 1) {				$this->getView()->assign("login",1);				$this->getView()->assign("user_id",$render_login_data['user_id']);				$this->getView()->assign("username",$render_login_data['username']);				$this->getView()->assign("user_photo",$render_login_data['user_photo']);			} else {				$this->getView()->assign("login",0);			}							//echo "<pre>";			$word = $this->getRequest()->getPost("word");			$posts = array();						$navbars = $this->getnavbar("category");			$categorys = $this->getcategory();			if (!empty($word)) {				$posts = $this->getposts_search($word);			}						//print_r($posts);			$rightbars = $this->getrightbar();			//echo "</pre>";			$this->getView()->assign("title","$word >> 搜索 >> i比熊 ");			$this->getView()->assign("navbar",$navbars);			$this->getView()->assign("category",$categorys);			$this->getView()->assign("rightbar",$rightbars);			$this->getView()->assign("post",$posts);			#$script = Yaf_Application::app()->getConfig()->smarty->template_dir."index/category.tpl";			#print_r($script);			$this->getView()->display(Yaf_Application::app()->getConfig()->smarty->template_dir . "index/search.tpl");		}	}		public function getposts_search($word) {		$searchmodel = new SearchModel();				$posts = $searchmodel->get_posts($word);				return $posts;	}		public function getnavbar($type="category") {		$searchmodel = new SearchModel();				$allnavbars = $searchmodel->get_navbars($type);					return $allnavbars;	}		/*public function getcategory($type="category") {		$searchmodel = new SearchModel();		$categorys = $searchmodel->get_categorys($type);		return $categorys;	}*/	protected function getcategory($type="share") {		$searchmodel = new SearchModel();		$category_result = array();			$categorys = $searchmodel->get_categorys($type);		//print_r($categorys);		foreach ($categorys as $category) {			$children = array();			$children = $searchmodel->get_child_category($category['category_id']);			$category['children'] = $children;			//print_r($category);			$category_result[] = $category;		}		return $category_result;	}			public function getrightbar() {		$rightbar_result = array();		$searchmodel = new SearchModel();		//echo "<pre>";		$rightbars = $searchmodel->get_rightbars();				foreach($rightbars as $rightbar) {						$hotlinks = $this->gethotlink($rightbar);			$rightbar['hotlinks'] = $hotlinks;			//var_dump($rightbar['hotlinks']);			$rightbar_result[] = $rightbar;		}				//$rightbar = $rightbars;		//var_dump($rightbar_result);		//echo "</pre>";		return $rightbar_result;	}		public function gethotlink($rightbar='') {		$searchmodel = new SearchModel();		$hots_result = array();		//var_dump($rightbar);		$type = $rightbar['option_name'];		$others = unserialize($rightbar['option_others']);		//var_dump($others);		if (isset($others['days'])) {			$days = intval($others['days']);		}		//var_dump($days);		$hotlinks = $searchmodel->get_hotlinks($type,$days);				foreach($hotlinks as $hotlink)		{			$hot['hotid'] = $hotlink[$type.'_id'];			if(isset($hotlink[$type.'_title'])) {				$hot['hotitle'] = $hotlink[$type.'_title'];			} else if($hotlink[$type.'_content']) {				$hot['hotitle'] = $hotlink[$type.'_content'];			}						$hots_result[] = $hot;		}		//$hotlinks['others'] = $others;		//var_dump($hots_result);				return $hots_result;	}	}